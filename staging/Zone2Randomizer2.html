<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workout Randomizer</title>
    <style>
        /* Same styles as before */
    </style>
</head>
<body>
    <h1>Workout Randomizer</h1>
    <p class="instructions">Click on exercises to deselect unwanted ones. By default, all are selected.</p>
    <div class="controls">
        <label for="duration">Workout Duration (minutes):</label>
        <input type="number" id="duration" value="10" min="1" max="120">
        <label for="exerciseDuration">Exercise Duration (seconds):</label>
        <input type="number" id="exerciseDuration" value="30" min="5" max="300">
        <label for="restDuration">Rest Duration (seconds):</label>
        <input type="number" id="restDuration" value="60" min="10" max="300">
        <label for="restFrequency">Rest After (exercises):</label>
        <input type="number" id="restFrequency" value="4" min="1" max="10">
        <button id="generate">Generate Workout</button>
    </div>
    <div class="exercise-selection" id="exerciseSelection"></div>
    <ul class="exercise-list" id="exerciseList"></ul>
    <div class="floating-timer" id="floatingTimer">
        <div id="timerDisplay">00:00</div>
        <button id="startTimer">Start</button>
        <button id="pauseTimer">Pause</button>
        <video id="currentExerciseVideo" autoplay loop muted></video>
    </div>
    <audio id="beepSound" src="sounds/beep.mp3" preload="auto"></audio>
    <script src="https://cdn.jsdelivr.net/npm/darkreader@4.9.58/darkreader.min.js"></script>
    <script>
        DarkReader.enable();

        const exercises = [
            { name: "Shadow Boxing", video: "/resources/shadowboxing.mp4" },
            { name: "Squats", video: "/resources/squats.mp4" },
            { name: "Push-Ups", video: "/resources/pushupsAngle2.mp4" },
            { name: "Bear Taps", video: "/resources/bearTapsAngle2.mp4" },
            { name: "Swipers", video: "/resources/swipersAngle2.mp4" },
            { name: "3-Way Lunges", video: "/resources/3wayLungesAngle2.mp4" },
            { name: "Shoulder Taps", video: "/resources/shoulderTapsAngle1.mp4" },
            { name: "Russian V-Twists", video: "/resources/russianVTwistsAngle1.mp4" },
            { name: "Bridges", video: "/resources/bridgesAngle2.mp4" },
            { name: "Spider-Man Lunges", video: "/resources/spidermanLungesAngle2.mp4" },
            { name: "Ab Roller", video: "/resources/abRollerAngle1.mp4" },
            { name: "Bicycle Crunches", video: "/resources/bicycleCrunchesAngle2.mp4" },
            { name: "Bench Dips", video: "/resources/benchDipsAngle1.mp4" },
            { name: "Toe Taps", video: "/resources/toeTaps.mp4" },
            { name: "Reverse Lunge to High Knee", video: "/resources/reverseLungeHighKneeAngle2.mp4" },
            { name: "Good Mornings", video: "/resources/goodMorningsAngle2.mp4" }
        ];

        const exerciseSelection = document.getElementById('exerciseSelection');
        const exerciseList = document.getElementById('exerciseList');
        const timerDisplay = document.getElementById('timerDisplay');
        const currentExerciseVideo = document.getElementById('currentExerciseVideo');
        const beepSound = document.getElementById('beepSound');

        let selectedExercises = [...exercises];
        let timerInterval = null;
        let timeRemaining = 0;
        let workoutSequence = [];
        let currentIndex = 0;

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function renderExerciseSelection() {
            exerciseSelection.innerHTML = '';
            exercises.forEach((exercise, index) => {
                const card = document.createElement('div');
                card.className = 'exercise-card selected';
                card.innerHTML = `<video src="${exercise.video}" autoplay loop muted></video><p>${exercise.name}</p>`;
                card.addEventListener('click', () => {
                    card.classList.toggle('selected');
                    if (card.classList.contains('selected')) {
                        selectedExercises.push(exercise);
                    } else {
                        selectedExercises = selectedExercises.filter(e => e.name !== exercise.name);
                    }
                });
                exerciseSelection.appendChild(card);
            });
        }

        function generateWorkout() {
            const duration = parseInt(document.getElementById('duration').value, 10) * 60;
            const exerciseDuration = parseInt(document.getElementById('exerciseDuration').value, 10);
            const restDuration = parseInt(document.getElementById('restDuration').value, 10);
            const restFrequency = parseInt(document.getElementById('restFrequency').value, 10);

            workoutSequence = [];
            shuffleArray(selectedExercises);
            let timeLeft = duration;
            let exerciseCounter = 0;

            while (timeLeft > 0) {
                if (exerciseCounter > 0 && exerciseCounter % restFrequency === 0) {
                    workoutSequence.push({ name: "Rest", video: "", duration: restDuration });
                    timeLeft -= restDuration;
                }

                for (let i = 0; i < selectedExercises.length && timeLeft > 0; i++) {
                    const exercise = selectedExercises[i];
                    workoutSequence.push({ ...exercise, duration: exerciseDuration });
                    timeLeft -= exerciseDuration;
                    exerciseCounter++;
                }
            }

            displayWorkout(workoutSequence);
        }

        function displayWorkout(workout) {
            exerciseList.innerHTML = '';
            workout.forEach((step, index) => {
                const li = document.createElement('li');
                li.textContent = step.name;
                if (index === 0) li.classList.add('active');
                exerciseList.appendChild(li);
            });
            currentIndex = 0;
            updateFloatingTimer(workout[currentIndex]);
        }

        function updateFloatingTimer(currentStep) {
            timerDisplay.textContent = `${currentStep.duration}s`;
            currentExerciseVideo.src = currentStep.video || '';
        }

        function startWorkout() {
            if (workoutSequence.length === 0) return;

            let currentStep = workoutSequence[currentIndex];
            timeRemaining = currentStep.duration;

            timerInterval = setInterval(() => {
                if (timeRemaining > 0) {
                    timeRemaining--;
                    timerDisplay.textContent = `${timeRemaining}s`;
                } else {
                    beepSound.play(); // Play sound on step change
                    currentIndex++;
                    if (currentIndex < workoutSequence.length) {
                        currentStep = workoutSequence[currentIndex];
                        updateFloatingTimer(currentStep);
                        timeRemaining = currentStep.duration;
                    } else {
                        clearInterval(timerInterval);
                        alert('Workout complete!');
                    }
                }
            }, 1000);
        }

        function pauseWorkout() {
            clearInterval(timerInterval);
        }

        renderExerciseSelection();
        document.getElementById('generate').addEventListener('click', generateWorkout);
        document.getElementById('startTimer').addEventListener('click', startWorkout);
        document.getElementById('pauseTimer').addEventListener('click', pauseWorkout);
    </script>
</body>
</html>
