<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Custom Workout Routine</title>
  <style>
  body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 20px;
  background: #f9f9f9;
}
#workout-container {
  max-width: 600px;
  margin: auto;
}
.exercise {
  border: 1px solid #ddd;
  padding: 10px;
  margin: 10px 0;
  background: #fff;
}
h2 {
  margin: 0;
  font-size: 1.2em;
}
button {
  margin: 10px 0;
}
 </style>
</head>
<body>
  <div id="workout-container">
    <h1>Custom Workout Routine</h1>
    <div id="exercises">
      <!-- Exercise blocks will be dynamically added here -->
    </div>
    <button id="add-exercise">Add Another Exercise</button>
    <button id="start-workout">Start Workout</button>
    <input type="file" id="import-routine" style="display: none;">
    <button id="import-btn">Import Saved Routine</button>
    <button id="export-btn">Export Routine</button>
  </div>

  <audio id="beep-sound" src="/sounds/beep.mp3"></audio>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const exercisesDiv = document.getElementById('exercises');
  const addExerciseBtn = document.getElementById('add-exercise');
  const startWorkoutBtn = document.getElementById('start-workout');
  let exercises = [];

  function addExercise() {
    const exerciseId = exercises.length + 1;
    const exerciseDiv = document.createElement('div');
    exerciseDiv.classList.add('exercise');
    exerciseDiv.setAttribute('draggable', true);

    exerciseDiv.innerHTML = `
      <h2 contenteditable="true">Exercise ${exerciseId}</h2>
      <select class="exercise-type">
        <option value="timed">Timed Exercise</option>
        <option value="rep">Rep Counter</option>
      </select>
      <div class="settings">
        <label>Sets: <input type="number" min="1" max="10" value="1" class="sets"></label>
        <div class="timed-options">
          <label>Exercise Time:
            <input type="number" class="exercise-hours" placeholder="H" min="0" max="23"> :
            <input type="number" class="exercise-minutes" placeholder="M" min="0" max="59"> :
            <input type="number" class="exercise-seconds" placeholder="S" min="0" max="59">
          </label>
        </div>
        <label>Rest Time:
          <input type="number" class="rest-hours" placeholder="H" min="0" max="23"> :
          <input type="number" class="rest-minutes" placeholder="M" min="0" max="59"> :
          <input type="number" class="rest-seconds" placeholder="S" min="0" max="59">
        </label>
      </div>
      <button class="delete-exercise">Delete Exercise</button>
    `;

    // Update visibility of inputs based on type
    const exerciseType = exerciseDiv.querySelector('.exercise-type');
    exerciseType.addEventListener('change', () => {
      const timedOptions = exerciseDiv.querySelector('.timed-options');
      timedOptions.style.display = exerciseType.value === 'timed' ? 'block' : 'none';
    });

    // Delete functionality
    const deleteBtn = exerciseDiv.querySelector('.delete-exercise');
    deleteBtn.addEventListener('click', () => {
      exerciseDiv.remove();
      exercises = exercises.filter((el) => el !== exerciseDiv);
    });

    // Drag-and-drop functionality
    exerciseDiv.addEventListener('dragstart', (e) => {
      e.dataTransfer.setData('text/plain', exercises.indexOf(exerciseDiv));
    });
    exercisesDiv.addEventListener('dragover', (e) => e.preventDefault());
    exercisesDiv.addEventListener('drop', (e) => {
      const fromIndex = e.dataTransfer.getData('text/plain');
      const toIndex = [...exercisesDiv.children].indexOf(e.target.closest('.exercise'));
      if (toIndex >= 0 && fromIndex >= 0 && fromIndex !== toIndex) {
        exercisesDiv.insertBefore(exercises[fromIndex], exercises[toIndex]);
        exercises.splice(toIndex, 0, exercises.splice(fromIndex, 1)[0]);
      }
    });

    exercisesDiv.appendChild(exerciseDiv);
    exercises.push(exerciseDiv);
  }

function startWorkout() {
  const workoutRoutine = exercises.map((exerciseDiv) => {
    const title = exerciseDiv.querySelector('h2').innerText;
    const type = exerciseDiv.querySelector('.exercise-type').value;
    const sets = parseInt(exerciseDiv.querySelector('.sets').value, 10);
    const exerciseTime = type === 'timed' ? {
      hours: parseInt(exerciseDiv.querySelector('.exercise-hours').value || 0, 10),
      minutes: parseInt(exerciseDiv.querySelector('.exercise-minutes').value || 0, 10),
      seconds: parseInt(exerciseDiv.querySelector('.exercise-seconds').value || 0, 10),
    } : null;
    const restTime = {
      hours: parseInt(exerciseDiv.querySelector('.rest-hours').value || 0, 10),
      minutes: parseInt(exerciseDiv.querySelector('.rest-minutes').value || 0, 10),
      seconds: parseInt(exerciseDiv.querySelector('.rest-seconds').value || 0, 10),
    };
    return { title, type, sets, exerciseTime, restTime };
  });

  // Recursive function to process exercises
  let currentExercise = 0;

  function runTimer(duration, message, callback) {
    let totalSeconds = duration.hours * 3600 + duration.minutes * 60 + duration.seconds;
    const interval = setInterval(() => {
      if (totalSeconds <= 0) {
        clearInterval(interval);
        beepSound.play();
        alert(message);
        callback();
        return;
      }
      console.log(`Remaining: ${Math.floor(totalSeconds / 3600)}:${Math.floor(totalSeconds / 60) % 60}:${totalSeconds % 60}`);
      totalSeconds--;
    }, 1000);
  }

  function processExercise() {
    if (currentExercise >= workoutRoutine.length) {
      alert('Routine Complete!');
      return;
    }

    const { title, type, sets, exerciseTime, restTime } = workoutRoutine[currentExercise];
    alert(`Starting: ${title}`);

    let currentSet = 1;

    function nextSet() {
      if (currentSet > sets) {
        currentExercise++;
        processExercise();
        return;
      }

      alert(`Set ${currentSet} of ${sets}`);
      if (type === 'timed') {
        runTimer(exerciseTime, 'Exercise Time Over', () => {
          runTimer(restTime, 'Rest Time Over', nextSet);
        });
      } else if (type === 'rep') {
        const proceed = confirm('Complete the set and click OK to continue.');
        if (proceed) {
          runTimer(restTime, 'Rest Time Over', nextSet);
        }
      }
      currentSet++;
    }

    nextSet();
  }

  processExercise();
}

function exportRoutine() {
  const routine = exercises.map((exerciseDiv) => ({
    title: exerciseDiv.querySelector('h2').innerText,
    type: exerciseDiv.querySelector('.exercise-type').value,
    sets: exerciseDiv.querySelector('.sets').value,
    exerciseTime: {
      hours: exerciseDiv.querySelector('.exercise-hours')?.value || 0,
      minutes: exerciseDiv.querySelector('.exercise-minutes')?.value || 0,
      seconds: exerciseDiv.querySelector('.exercise-seconds')?.value || 0,
    },
    restTime: {
      hours: exerciseDiv.querySelector('.rest-hours')?.value || 0,
      minutes: exerciseDiv.querySelector('.rest-minutes')?.value || 0,
      seconds: exerciseDiv.querySelector('.rest-seconds')?.value || 0,
    },
  }));

  const blob = new Blob([JSON.stringify(routine)], { type: 'application/json' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = 'routine.json';
  link.click();
}
function importRoutine(event) {
  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = () => {
    const routine = JSON.parse(reader.result);
    exercisesDiv.innerHTML = '';
    exercises = [];
    routine.forEach((exerciseData) => {
      addExercise();
      const exerciseDiv = exercises[exercises.length - 1];
      exerciseDiv.querySelector('h2').innerText = exerciseData.title;
      exerciseDiv.querySelector('.exercise-type').value = exerciseData.type;
      exerciseDiv.querySelector('.sets').value = exerciseData.sets;
      if (exerciseData.type === 'timed') {
        exerciseDiv.querySelector('.exercise-hours').value = exerciseData.exerciseTime.hours;
        exerciseDiv.querySelector('.exercise-minutes').value = exerciseData.exerciseTime.minutes;
        exerciseDiv.querySelector('.exercise-seconds').value = exerciseData.exerciseTime.seconds;
      }
      exerciseDiv.querySelector('.rest-hours').value = exerciseData.restTime.hours;
      exerciseDiv.querySelector('.rest-minutes').value = exerciseData.restTime.minutes;
      exerciseDiv.querySelector('.rest-seconds').value = exerciseData.restTime.seconds;
    });
  };
  reader.readAsText(file);
}
addExerciseBtn.addEventListener('click', addExercise);
startWorkoutBtn.addEventListener('click', startWorkout);
exportRoutineBtn.addEventListener('click', exportRoutine);
importRoutineBtn.addEventListener('click', () => document.getElementById('import-routine').click());
document.getElementById('import-routine').addEventListener('change', importRoutine);

});
</script>
</body>
</html>
