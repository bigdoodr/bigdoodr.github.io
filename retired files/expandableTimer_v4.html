<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Workout Routine Builder</title>
  <style>
    :root {
      --primary: #4a6eb5;
      --primary-dark: #3a5b9f;
      --secondary: #ff9800;
      --accent: #03dac6;
      --danger: #cf6679;
      --light: #f5f5f5;
      --dark: #121212;
      --gray: #757575;
      --light-gray: #e0e0e0;
      --white: #ffffff;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --border-radius: 8px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background-color: var(--light);
      color: var(--dark);
      line-height: 1.6;
      min-height: 100vh;
      padding: 1rem;
    }

    h1, h2, h3 {
      color: var(--primary-dark);
      margin-bottom: 1rem;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1rem;
    }

    .app-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .logo {
      font-size: 1.8rem;
      font-weight: bold;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .logo svg {
      width: 32px;
      height: 32px;
      fill: var(--primary);
    }

    .main-button {
      background-color: var(--primary);
      color: var(--white);
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: var(--border-radius);
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      box-shadow: var(--shadow);
    }

    .main-button:hover {
      background-color: var(--primary-dark);
      transform: translateY(-2px);
    }

    .main-button:active {
      transform: translateY(0);
    }

    .main-button svg {
      width: 18px;
      height: 18px;
      fill: currentColor;
    }

    .button-group {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .secondary-button {
      background-color: var(--white);
      color: var(--primary);
      border: 1px solid var(--primary);
      padding: 0.75rem 1.5rem;
      border-radius: var(--border-radius);
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .secondary-button:hover {
      background-color: rgba(74, 110, 181, 0.1);
    }

    .danger-button {
      background-color: var(--danger);
      color: var(--white);
    }

    .danger-button:hover {
      background-color: #b55566;
    }

    .card {
      background-color: var(--white);
      border-radius: var(--border-radius);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: var(--shadow);
    }

    .card h2 {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 1.5rem;
    }

    .card h2 svg {
      width: 24px;
      height: 24px;
      fill: var(--primary);
    }

    .exercise-list {
      margin-top: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .exercise-item {
      background-color: var(--white);
      border: 1px solid var(--light-gray);
      border-radius: var(--border-radius);
      padding: 1rem;
      margin-bottom: 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      transition: all 0.3s ease;
      position: relative;
    }

    .exercise-item.active {
      border-color: var(--primary);
      background-color: rgba(74, 110, 181, 0.05);
      box-shadow: 0 0 0 2px rgba(74, 110, 181, 0.3);
    }

    .exercise-item.resting {
      border-color: var(--secondary);
      background-color: rgba(255, 152, 0, 0.05);
      box-shadow: 0 0 0 2px rgba(255, 152, 0, 0.3);
    }

    .exercise-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .exercise-name {
      font-weight: 600;
      font-size: 1.1rem;
      flex-grow: 1;
      margin-right: 1rem;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      display: inline-block;
    }

    .exercise-name-input {
      font-weight: 600;
      font-size: 1.1rem;
      flex-grow: 1;
      margin-right: 1rem;
      border: 1px solid var(--light-gray);
      border-radius: 4px;
      padding: 0.25rem 0.5rem;
    }

    .exercise-controls {
      display: flex;
      gap: 0.5rem;
    }

    .exercise-detail {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      align-items: center;
    }

    .exercise-type {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .exercise-type label {
      display: flex;
      align-items: center;
      gap: 0.25rem;
      cursor: pointer;
    }

    .exercise-duration, .exercise-reps, .exercise-rest {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .exercise-sets {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .drag-handle {
      cursor: grab;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0.25rem;
      color: var(--gray);
    }

    .drag-handle:active {
      cursor: grabbing;
    }

    .drag-handle svg {
      width: 18px;
      height: 18px;
      fill: currentColor;
    }

    .exercise-action {
      background: none;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0.25rem;
      color: var(--gray);
      transition: all 0.2s ease;
    }

    .exercise-action:hover {
      color: var(--primary);
    }

    .exercise-action.delete:hover {
      color: var(--danger);
    }

    .exercise-action svg {
      width: 18px;
      height: 18px;
      fill: currentColor;
    }

    .input-group {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    input[type="number"], 
    input[type="text"] {
      border: 1px solid var(--light-gray);
      border-radius: 4px;
      padding: 0.5rem;
      width: 80px;
      text-align: center;
    }

    input[type="text"].exercise-name-input {
      width: 100%;
      text-align: left;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: var(--primary-dark);
    }
    
    .input-error {
      color: var(--danger);
      font-size: 0.875rem;
      margin-top: 0.25rem;
    }

    .form-row {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }

    .form-col {
      flex: 1;
      min-width: 250px;
    }

    .action-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 1.5rem;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .progress-container {
      width: 100%;
      height: 8px;
      background-color: var(--light-gray);
      border-radius: 4px;
      overflow: hidden;
      margin-top: 0.5rem;
    }

    .progress-bar {
      height: 100%;
      background-color: var(--primary);
      width: 0;
      transition: width 0.5s linear;
    }

    .progress-rest {
      background-color: var(--secondary);
    }

    .workout-info {
      display: flex;
      align-items: center;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .info-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background-color: rgba(74, 110, 181, 0.1);
      padding: 0.5rem 1rem;
      border-radius: 2rem;
      font-size: 0.875rem;
    }

    .info-item svg {
      width: 16px;
      height: 16px;
      fill: var(--primary);
    }

    .timer-display {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--primary);
      text-align: center;
      margin-bottom: 1rem;
    }

    .workout-status {
      text-align: center;
      margin-bottom: 1rem;
      font-size: 1.25rem;
      font-weight: 600;
    }

    .workout-status.exercise {
      color: var(--primary);
    }

    .workout-status.rest {
      color: var(--secondary);
    }

    .workout-status.completed {
      color: var(--accent);
    }

    .tab-container {
      margin-bottom: 2rem;
    }

    .tab-buttons {
      display: flex;
      border-bottom: 1px solid var(--light-gray);
      margin-bottom: 1rem;
      overflow-x: auto;
      scrollbar-width: none;
    }

    .tab-buttons::-webkit-scrollbar {
      display: none;
    }

    .tab-button {
      background: none;
      border: none;
      padding: 1rem 1.5rem;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      color: var(--gray);
      position: relative;
      white-space: nowrap;
    }

    .tab-button.active {
      color: var(--primary);
    }

    .tab-button.active::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      width: 100%;
      height: 2px;
      background-color: var(--primary);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .preset-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .preset-card {
      background-color: var(--white);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      padding: 1.5rem;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid transparent;
    }

    .preset-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
      border-color: var(--primary);
    }

    .preset-card h3 {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .preset-card h3 svg {
      width: 20px;
      height: 20px;
      fill: var(--primary);
    }

    .preset-card p {
      color: var(--gray);
      font-size: 0.875rem;
      margin-bottom: 1rem;
    }

    .tag-list {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .tag {
      background-color: rgba(74, 110, 181, 0.1);
      color: var(--primary);
      padding: 0.25rem 0.75rem;
      border-radius: 2rem;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 1rem;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      background-color: var(--white);
      border-radius: var(--border-radius);
      padding: 2rem;
      width: 100%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      transform: translateY(-20px);
      transition: all 0.3s ease;
    }

    .modal-overlay.active .modal {
      transform: translateY(0);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .modal-close {
      background: none;
      border: none;
      cursor: pointer;
      color: var(--gray);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0.5rem;
    }

    .modal-close:hover {
      color: var(--danger);
    }

    .modal-close svg {
      width: 20px;
      height: 20px;
      fill: currentColor;
    }

    .summary-list {
      margin-top: 1rem;
    }

    .summary-item {
      display: flex;
      justify-content: space-between;
      padding: 0.75rem 0;
      border-bottom: 1px solid var(--light-gray);
    }

    .summary-item:last-child {
      border-bottom: none;
    }

    .summary-label {
      font-weight: 600;
    }

    .summary-value {
      color: var(--primary);
      font-weight: 600;
    }

    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: var(--white);
      color: var(--dark);
      padding: 1rem 1.5rem;
      border-radius: var(--border-radius);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      display: flex;
      align-items: center;
      gap: 0.75rem;
      z-index: 1001;
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s ease;
    }

    .toast.active {
      transform: translateY(0);
      opacity: 1;
    }

    .toast.success {
      border-left: 4px solid #4caf50;
    }

    .toast.error {
      border-left: 4px solid var(--danger);
    }

    .toast-icon {
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .toast-icon svg {
      width: 20px;
      height: 20px;
      fill: currentColor;
    }

    .toast.success .toast-icon {
      color: #4caf50;
    }

    .toast.error .toast-icon {
      color: var(--danger);
    }

    .toast-content {
      flex-grow: 1;
    }

    .toast-close {
      background: none;
      border: none;
      cursor: pointer;
      color: var(--gray);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0.25rem;
    }

    .toast-close svg {
      width: 16px;
      height: 16px;
      fill: currentColor;
    }

    @media (max-width: 768px) {
      .exercise-item {
        padding: 0.75rem;
      }

      .exercise-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
      }

      .exercise-name {
        margin-right: 0;
      }

      .exercise-controls {
        width: 100%;
        justify-content: flex-end;
      }

      .form-row {
        flex-direction: column;
        gap: 1rem;
      }

      .form-col {
        min-width: auto;
      }

      .app-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .button-group {
        width: 100%;
        justify-content: space-between;
      }

      .action-bar {
        flex-direction: column;
        align-items: stretch;
      }

      .action-bar .button-group {
        width: 100%;
      }

      .workout-info {
        justify-content: center;
      }
    }

    /* Placeholder animation for loading states */
    @keyframes pulse {
      0% {
        opacity: 0.6;
      }
      50% {
        opacity: 0.8;
      }
      100% {
        opacity: 0.6;
      }
    }

    .placeholder {
      animation: pulse 1.5s infinite;
      background-color: var(--light-gray);
      border-radius: 4px;
    }

    /* Audio indicator animation */
    @keyframes beep {
      0% {
        transform: scale(1);
        opacity: 0.8;
      }
      50% {
        transform: scale(1.2);
        opacity: 1;
      }
      100% {
        transform: scale(1);
        opacity: 0.8;
      }
    }

    .audio-indicator {
      position: fixed;
      bottom: 20px;
      left: 20px;
      width: 40px;
      height: 40px;
      background-color: var(--primary);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      visibility: hidden;
      opacity: 0;
      transition: all 0.3s ease;
    }

    .audio-indicator.active {
      visibility: visible;
      opacity: 1;
      animation: beep 0.5s ease-in-out;
    }

    .audio-indicator svg {
      width: 20px;
      height: 20px;
      fill: currentColor;
    }

    .file-input {
      display: none;
    }

  </style>
</head>
<body>
  <div class="container">
    <header class="app-header">
      <div class="logo">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 5C8.13401 5 5 8.13401 5 12C5 15.866 8.13401 19 12 19C15.866 19 19 15.866 19 12C19 8.13401 15.866 5 12 5ZM3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12ZM13 8C13 8.55228 12.5523 9 12 9C11.4477 9 11 8.55228 11 8C11 7.44772 11.4477 7 12 7C12.5523 7 13 7.44772 13 8ZM11 10.75C11 10.3358 11.3358 10 11.75 10H12.25C12.6642 10 13 10.3358 13 10.75V16.25C13 16.6642 12.6642 17 12.25 17H11.75C11.3358 17 11 16.6642 11 16.25V10.75Z"></path></svg>
        Workout Routine Builder
      </div>
      <div class="button-group">
        <button id="importBtn" class="secondary-button">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12.9999 16.1716L18.3638 10.8076L19.778 12.2218L11.9999 20L4.22168 12.2218L5.63589 10.8076L10.9999 16.1716V4H12.9999V16.1716Z"></path></svg>
          Import
        </button>
        <button id="exportBtn" class="secondary-button">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12.9999 7.82843V20H10.9999V7.82843L5.63589 13.1924L4.22168 11.7782L11.9999 4L19.778 11.7782L18.3638 13.1924L12.9999 7.82843Z"></path></svg>
          Export
        </button>
        <input type="file" id="fileInput" class="file-input" accept=".json">
      </div>
    </header>

    <div class="tab-container">
      <div class="tab-buttons">
        <button class="tab-button active" data-tab="builder">Builder</button>
        <button class="tab-button" data-tab="presets">Presets</button>
        <button class="tab-button" data-tab="workout">Workout</button>
      </div>

      <div id="builder" class="tab-content active">
        <div class="card">
          <h2>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12.9999 7.82843V20H10.9999V7.82843L5.63589 13.1924L4.22168 11.7782L11.9999 4L19.778 11.7782L18.3638 13.1924L12.9999 7.82843Z"></path></svg>
            Create Your Workout
          </h2>
          <div class="exercise-list" id="exerciseList">
            <!-- Exercise items will be added here -->
          </div>
          <div class="action-bar">
            <button id="addExerciseBtn" class="main-button">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M11 11V5H13V11H19V13H13V19H11V13H5V11H11Z"></path></svg>
              Add Exercise
            </button>
            <div class="workout-info">
              <div class="info-item">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20ZM13 12H17V14H11V7H13V12Z"></path></svg>
                <span id="totalTime">0 min</span>
              </div>
              <div class="info-item">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 17H17V14H19V19H5V14H7V17ZM7 7H17V10H19V5H5V10H7V7ZM4 11H20V13H4V11Z"></path></svg>
                <span id="totalExercises">0 exercises</span>
              </div>
              <div class="info-item">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5 15V17C5 18.0544 5.81588 18.9182 6.85073 18.9945L7 19H17C18.0544 19 18.9182 18.1841 18.9945 17.1493L19 17V15H21V17C21 19.2091 19.2091 21 17 21H7C4.79086 21 3 19.2091 3 17V15H5ZM16 12L11.5 7.5L13 6L20 13L13 20L11.5 18.5L16 14H3V12H16Z"></path></svg>
                <span id="totalSets">0 sets</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="presets" class="tab-content">
        <div class="card">
          <h2>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8 4H6V2H8V4ZM4 8H2V6H4V8ZM18 20H16V22H18V20ZM14 20H12V22H14V20ZM22 12H20V14H22V12ZM17.5 13C16.12 13 15 14.12 15 15.5V16.5C15 17.88 16.12 19 17.5 19H20C21.1 19 22 18.1 22 17V15.5C22 14.12 20.88 13 19.5 13H17.5ZM17.5 15H19.5C19.78 15 20 15.22 20 15.5V17C20 17.28 19.78 17.5 19.5 17.5H17.5C17.22 17.5 17 17.28 17 17V15.5C17 15.22 17.22 15 17.5 15ZM14 17H12V15H14V17ZM4 7V11H9V7H4ZM6 9H7V10H6V9ZM9 12V16H14V12H9ZM11 14H12V15H11V14ZM4 17V21H9V17H4ZM6 19H7V20H6V19ZM22 7H20V9H22V7ZM10 7H14V5H10V7ZM20 6H18V4H20V6Z"></path></svg>
            Workout Presets
          </h2>
          <p>Choose a preset workout routine to get started quickly.</p>
          <div class="preset-cards">
            <div class="preset-card" data-preset="quick-hiit">
              <h3>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.41421 15.8921L5 14.4779L11.0711 8.40683L16.7426 14.0783L22.4142 8.40683L23.8284 9.82104L16.7426 16.9069L11.0711 11.2354L6.41421 15.8921Z"></path></svg>
                Quick HIIT
              </h3>
              <p>High-intensity interval training with 30-second exercises and 15-second rest periods.</p>
              <div class="tag-list">
                <span class="tag">20 min</span>
                <span class="tag">High Intensity</span>
                <span class="tag">Full Body</span>
              </div>
            </div>
            <div class="preset-card" data-preset="strength-circuit">
              <h3>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7.5 11.5C5.01472 11.5 3 9.48528 3 7C3 4.51472 5.01472 2.5 7.5 2.5C9.98528 2.5 12 4.51472 12 7C12 9.48528 9.98528 11.5 7.5 11.5ZM7.5 21.5C5.01472 21.5 3 19.4853 3 17C3 14.5147 5.01472 12.5 7.5 12.5C9.98528 12.5 12 14.5147 12 17C12 19.4853 9.98528 21.5 7.5 21.5ZM17.5 11.5C15.0147 11.5 13 9.48528 13 7C13 4.51472 15.0147 2.5 17.5 2.5C19.9853 2.5 22 4.51472 22 7C22 9.48528 19.9853 11.5 17.5 11.5ZM17.5 21.5C15.0147 21.5 13 19.4853 13 17C13 14.5147 15.0147 12.5 17.5 12.5C19.9853 12.5 22 14.5147 22 17C22 19.4853 19.9853 21.5 17.5 21.5ZM7.5 9.5C8.88071 9.5 10 8.38071 10 7C10 5.61929 8.88071 4.5 7.5 4.5C6.11929 4.5 5 5.61929 5 7C5 8.38071 6.11929 9.5 7.5 9.5ZM7.5 19.5C8.88071 19.5 10 18.3807 10 17C10 15.6193 8.88071 14.5 7.5 14.5C6.11929 14.5 5 15.6193 5 17C5 18.3807 6.11929 19.5 7.5 19.5ZM17.5 9.5C18.8807 9.5 20 8.38071 20 7C20 5.61929 18.8807 4.5 17.5 4.5C16.1193 4.5 15 5.61929 15 7C15 8.38071 16.1193 9.5 17.5 9.5ZM17.5 19.5C18.8807 19.5 20 18.3807 20 17C20 15.6193 18.8807 14.5 17.5 14.5C16.1193 14.5 15 15.6193 15 17C15 18.3807 16.1193 19.5 17.5 19.5Z"></path></svg>
                Strength Circuit
              </h3>
              <p>Full-body strength training with compound exercises and 60-second rest periods.</p>
              <div class="tag-list">
                <span class="tag">45 min</span>
                <span class="tag">Strength</span>
                <span class="tag">Circuit</span>
              </div>
            </div>
            <div class="preset-card" data-preset="tabata-protocol">
              <h3>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.5 21C10.3579 21 7 17.6421 7 13.5C7 9.35786 10.3579 6 14.5 6C18.6421 6 22 9.35786 22 13.5C22 17.6421 18.6421 21 14.5 21ZM14.5 19C17.5376 19 20 16.5376 20 13.5C20 10.4624 17.5376 8 14.5 8C11.4624 8 9 10.4624 9 13.5C9 16.5376 11.4624 19 14.5 19ZM14.5 17C12.567 17 11 15.433 11 13.5C11 11.567 12.567 10 14.5 10C16.433 10 18 11.567 18 13.5C18 15.433 16.433 17 14.5 17ZM2 12V7H7V12H2ZM2 19V14H7V19H2ZM9 5V0H14V5H9Z"></path></svg>
                Tabata Protocol
              </h3>
              <p>20 seconds of intense work followed by 10 seconds of rest, repeated 8 times per exercise.</p>
              <div class="tag-list">
                <span class="tag">4 min per set</span>
                <span class="tag">HIIT</span>
                <span class="tag">Intense</span>
              </div>
            </div>
            <div class="preset-card" data-preset="5x5-strength">
              <h3>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17.5 12C20.5376 12 23 9.53757 23 6.5C23 3.46243 20.5376 1 17.5 1C14.4624 1 12 3.46243 12 6.5C12 9.53757 14.4624 12 17.5 12ZM6.5 23C9.53757 23 12 20.5376 12 17.5C12 14.4624 9.53757 12 6.5 12C3.46243 12 1 14.4624 1 17.5C1 20.5376 3.46243 23 6.5 23ZM6.5 21C8.433 21 10 19.433 10 17.5C10 15.567 8.433 14 6.5 14C4.567 14 3 15.567 3 17.5C3 19.433 4.567 21 6.5 21ZM17.5 10C19.433 10 21 8.433 21 6.5C21 4.567 19.433 3 17.5 3C15.567 3 14 4.567 14 6.5C14 8.433 15.567 10 17.5 10Z"></path></svg>
                5x5 Strength
              </h3>
              <p>Five sets of five reps for each exercise with longer rest periods for maximum strength gains.</p>
              <div class="tag-list">
                <span class="tag">60 min</span>
                <span class="tag">Strength</span>
                <span class="tag">Progressive</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="workout" class="tab-content">
        <div class="card">
          <h2>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20ZM13 12H17V14H11V7H13V12Z"></path></svg>
            Workout Session
          </h2>
          <div class="timer-display" id="timerDisplay">00:00</div>
          <div class="workout-status" id="workoutStatus">Ready to start</div>
          <div class="exercise-list" id="workoutExerciseList">
            <!-- Active workout exercises will be displayed here -->
            <div class="placeholder" style="height: 200px; width: 100%;"></div>
          </div>
          <div class="action-bar">
            <div class="button-group">
              <button id="startWorkoutBtn" class="main-button">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19.376 12.4158L8.77735 19.4158C8.54759 19.5702 8.23715 19.4998 8.0828 19.27C8.02915 19.1916 8 19.0979 8 19.0001V5.00008C8 4.72394 8.22386 4.50008 8.5 4.50008C8.59786 4.50008 8.69154 4.52923 8.77005 4.58287L19.3687 11.5829C19.5979 11.7379 19.6676 12.0485 19.5126 12.2777C19.4787 12.3273 19.4355 12.3708 19.386 12.4047L19.376 12.4158Z"></path></svg>
                Start Workout
              </button>
              <button id="pauseWorkoutBtn" class="secondary-button" disabled>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6 5H8V19H6V5ZM16 5H18V19H16V5Z"></path></svg>
                Pause
              </button>
              <button id="stopWorkoutBtn" class="secondary-button danger-button" disabled>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6 5H18V19H6V5Z"></path></svg>
                Stop
              </button>
            </div>
            <div class="workout-info">
              <div class="info-item">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20ZM13 12H17V14H11V7H13V12Z"></path></svg>
                <span id="elapsedTime">00:00</span>
              </div>
              <div class="info-item">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 16.1716L19.071 6.10051L20.4853 7.51472L9 19L3.51472 13.5147L4.92893 12.1005L9 16.1716Z"></path></svg>
                <span id="completedExercises">0/0 completed</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal for workout summary -->
  <div class="modal-overlay" id="summaryModal">
    <div class="modal">
      <div class="modal-header">
        <h2>Workout Summary</h2>
        <button class="modal-close" id="closeSummaryModal">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12.0007 10.5865L16.9504 5.63672L18.3646 7.05093L13.4149 12.0007L18.3646 16.9504L16.9504 18.3646L12.0007 13.4149L7.05093 18.3646L5.63672 16.9504L10.5865 12.0007L5.63672 7.05093L7.05093 5.63672L12.0007 10.5865Z"></path></svg>
        </button>
      </div>
      <div id="summaryContent">
        <div class="summary-list">
          <div class="summary-item">
            <div class="summary-label">Total Duration</div>
            <div class="summary-value" id="summaryDuration">00:00</div>
          </div>
          <div class="summary-item">
            <div class="summary-label">Exercises Completed</div>
            <div class="summary-value" id="summaryExercises">0/0</div>
          </div>
          <div class="summary-item">
            <div class="summary-label">Sets Completed</div>
            <div class="summary-value" id="summarySets">0</div>
          </div>
          <div class="summary-item">
            <div class="summary-label">Active Time</div>
            <div class="summary-value" id="summaryActiveTime">00:00</div>
          </div>
          <div class="summary-item">
            <div class="summary-label">Rest Time</div>
            <div class="summary-value" id="summaryRestTime">00:00</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast notifications -->
  <div class="toast" id="toast">
    <div class="toast-icon">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20ZM11 15H13V17H11V15ZM11 7H13V13H11V7Z"></path></svg>
    </div>
    <div class="toast-content" id="toastMessage"></div>
    <button class="toast-close" id="closeToast">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12.0007 10.5865L16.9504 5.63672L18.3646 7.05093L13.4149 12.0007L18.3646 16.9504L16.9504 18.3646L12.0007 13.4149L7.05093 18.3646L5.63672 16.9504L10.5865 12.0007L5.63672 7.05093L7.05093 5.63672L12.0007 10.5865Z"></path></svg>
    </button>
  </div>

  <!-- Audio indicator -->
  <div class="audio-indicator" id="audioIndicator">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5.88657 21C5.57547 21 5.3399 20.7189 5.39427 20.4126L6.00001 17H2.59511C2.28449 17 2.04905 16.7198 2.10259 16.4138L2.27759 15.4138C2.31946 15.1746 2.52722 15 2.77011 15H6.35001L7.41001 9H4.00511C3.69449 9 3.45905 8.71977 3.51259 8.41381L3.68759 7.41381C3.72946 7.17456 3.93722 7 4.18011 7H7.76001L8.39677 3.41262C8.43914 3.17391 8.64664 3 8.88907 3H9.87344C10.1845 3 10.4201 3.28107 10.3657 3.58738L9.76001 7H15.76L16.3968 3.41262C16.4391 3.17391 16.6466 3 16.8891 3H17.8734C18.1845 3 18.4201 3.28107 18.3657 3.58738L17.76 7H21.1649C21.4755 7 21.711 7.28023 21.6574 7.58619L21.4824 8.58619C21.4406 8.82544 21.2328 9 20.9899 9H17.41L16.35 15H19.7549C20.0655 15 20.301 15.2802 20.2474 15.5862L20.0724 16.5862C20.0306 16.8254 19.8228 17 19.5799 17H16L15.3632 20.5874C15.3209 20.8261 15.1134 21 14.8709 21H13.8866C13.5755 21 13.3399 20.7189 13.3943 20.4126L14 17H8.00001L7.36325 20.5874C7.32088 20.8261 7.11337 21 6.87094 21H5.88657ZM9.41045 9L8.35045 15H14.3504L15.4104 9H9.41045Z"></path></svg>
  </div>

  <audio id="beepSound" src="/sounds/beep.mp3" preload="auto"></audio>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // State management
      const state = {
        exercises: [],
        activeExerciseIndex: -1,
        currentSet: 1,
        isResting: false,
        isWorkoutActive: false,
        workoutStartTime: null,
        elapsedTime: 0,
        activeTime: 0,
        restTime: 0,
        timer: null,
        remainingTime: 0,
        isPaused: false,
        completedExercises: 0,
        completedSets: 0,
        lastDraggedIndex: null
      };

      // DOM Elements
      const exerciseList = document.getElementById('exerciseList');
      const workoutExerciseList = document.getElementById('workoutExerciseList');
      const addExerciseBtn = document.getElementById('addExerciseBtn');
      const startWorkoutBtn = document.getElementById('startWorkoutBtn');
      const pauseWorkoutBtn = document.getElementById('pauseWorkoutBtn');
      const stopWorkoutBtn = document.getElementById('stopWorkoutBtn');
      const timerDisplay = document.getElementById('timerDisplay');
      const workoutStatus = document.getElementById('workoutStatus');
      const elapsedTimeDisplay = document.getElementById('elapsedTime');
      const completedExercisesDisplay = document.getElementById('completedExercises');
      const totalTimeDisplay = document.getElementById('totalTime');
      const totalExercisesDisplay = document.getElementById('totalExercises');
      const totalSetsDisplay = document.getElementById('totalSets');
      const tabButtons = document.querySelectorAll('.tab-button');
      const tabContents = document.querySelectorAll('.tab-content');
      const presetCards = document.querySelectorAll('.preset-card');
      const beepSound = document.getElementById('beepSound');
      const audioIndicator = document.getElementById('audioIndicator');
      const importBtn = document.getElementById('importBtn');
      const exportBtn = document.getElementById('exportBtn');
      const fileInput = document.getElementById('fileInput');
      const summaryModal = document.getElementById('summaryModal');
      const closeSummaryModal = document.getElementById('closeSummaryModal');
      const summaryDuration = document.getElementById('summaryDuration');
      const summaryExercises = document.getElementById('summaryExercises');
      const summarySets = document.getElementById('summarySets');
      const summaryActiveTime = document.getElementById('summaryActiveTime');
      const summaryRestTime = document.getElementById('summaryRestTime');
      const toast = document.getElementById('toast');
      const toastMessage = document.getElementById('toastMessage');
      const closeToast = document.getElementById('closeToast');

      // Helpers
      function formatTime(seconds) {
        const minutes = Math.floor(seconds / 60);
        const remainingSeconds = Math.floor(seconds % 60);
        return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
      }

      function formatTimeWithUnit(seconds) {
        const minutes = Math.floor(seconds / 60);
        if (minutes < 1) {
          return `${seconds} sec`;
        }
        return `${minutes} min`;
      }

      function playBeep() {
        beepSound.currentTime = 0;
        const playPromise = beepSound.play();
        
        if (playPromise !== undefined) {
          playPromise.then(_ => {
            // Show audio indicator
            audioIndicator.classList.add('active');
            setTimeout(() => {
              audioIndicator.classList.remove('active');
            }, 500);
          }).catch(error => {
            showToast('Error playing sound. Please interact with the page first.', 'error');
          });
        }
      }

      function showToast(message, type = 'success') {
        toastMessage.textContent = message;
        toast.className = `toast ${type} active`;
        
        setTimeout(() => {
          toast.classList.remove('active');
        }, 3000);
      }

      closeToast.addEventListener('click', () => {
        toast.classList.remove('active');
      });

      // Exercise management
      function addExercise(exerciseData = null) {
        const exercise = exerciseData || {
          id: Date.now(),
          name: `Exercise ${state.exercises.length + 1}`,
          type: 'timed', // 'timed' or 'reps'
          duration: 30,
          rest: 15,
          reps: 10,
          sets: 3
        };
        
        state.exercises.push(exercise);
        renderExercises();
        updateWorkoutInfo();
      }

      function updateExercise(id, updates) {
        const index = state.exercises.findIndex(ex => ex.id === id);
        if (index !== -1) {
          state.exercises[index] = { ...state.exercises[index], ...updates };
          renderExercises();
          updateWorkoutInfo();
        }
      }

      function removeExercise(id) {
        const index = state.exercises.findIndex(ex => ex.id === id);
        if (index !== -1) {
          state.exercises.splice(index, 1);
          renderExercises();
          updateWorkoutInfo();
        }
      }

      function moveExercise(fromIndex, toIndex) {
        if (fromIndex === toIndex) return;
        
        const exercise = state.exercises.splice(fromIndex, 1)[0];
        state.exercises.splice(toIndex, 0, exercise);
        renderExercises();
      }

      function renderExercises() {
        exerciseList.innerHTML = '';
        
        if (state.exercises.length === 0) {
          exerciseList.innerHTML = '<p class="empty-state">No exercises added yet. Click "Add Exercise" to get started.</p>';
          return;
        }
        
        state.exercises.forEach((exercise, index) => {
          const exerciseItem = document.createElement('div');
          exerciseItem.className = 'exercise-item';
          exerciseItem.dataset.id = exercise.id;
          exerciseItem.dataset.index = index;
          
          exerciseItem.innerHTML = `
            <div class="exercise-header">
              <div class="drag-handle">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 21C13.6569 21 15 19.6569 15 18C15 16.3431 13.6569 15 12 15C10.3431 15 9 16.3431 9 18C9 19.6569 10.3431 21 12 21ZM12 9C13.6569 9 15 7.65685 15 6C15 4.34315 13.6569 3 12 3C10.3431 3 9 4.34315 9 6C9 7.65685 10.3431 9 12 9Z"></path></svg>
              </div>
              <span class="exercise-name" data-id="${exercise.id}">${exercise.name}</span>
              <div class="exercise-controls">
                <button class="exercise-action" data-action="edit" title="Edit name">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12.8995 6.85431L17.1421 11.0969L7.24264 20.9963H3V16.7537L12.8995 6.85431ZM14.3137 5.44009L16.435 3.31877C17.0208 2.73299 17.9792 2.73299 18.565 3.31877L20.6863 5.44009C21.2721 6.02588 21.2721 6.98421 20.6863 7.57L18.565 9.69132L14.3137 5.44009Z"></path></svg>
                </button>
                <button class="exercise-action delete" data-action="delete" title="Delete exercise">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 4V2H17V4H22V6H20V21C20 21.5523 19.5523 22 19 22H5C4.44772 22 4 21.5523 4 21V6H2V4H7ZM6 6V20H18V6H6ZM9 9H11V17H9V9ZM13 9H15V17H13V9Z"></path></svg>
                </button>
              </div>
            </div>
            <div class="exercise-detail">
              <div class="exercise-type">
                <label>
                  <input type="radio" name="type-${exercise.id}" value="timed" 
                    ${exercise.type === 'timed' ? 'checked' : ''}>
                  Timed
                </label>
                <label>
                  <input type="radio" name="type-${exercise.id}" value="reps"
                    ${exercise.type === 'reps' ? 'checked' : ''}>
                  Reps
                </label>
              </div>
              ${exercise.type === 'timed' ? `
                <div class="exercise-duration">
                  <span>Duration:</span>
                  <div class="input-group">
                    <input type="number" min="1" max="300" value="${exercise.duration}" data-field="duration">
                    <span>sec</span>
                  </div>
                </div>
              ` : `
                <div class="exercise-reps">
                  <span>Reps:</span>
                  <div class="input-group">
                    <input type="number" min="1" max="100" value="${exercise.reps}" data-field="reps">
                  </div>
                </div>
              `}
              <div class="exercise-rest">
                <span>Rest:</span>
                <div class="input-group">
                  <input type="number" min="0" max="300" value="${exercise.rest}" data-field="rest">
                  <span>sec</span>
                </div>
              </div>
              <div class="exercise-sets">
                <span>Sets:</span>
                <div class="input-group">
                  <input type="number" min="1" max="20" value="${exercise.sets}" data-field="sets">
                </div>
              </div>
            </div>
          `;
          
          exerciseList.appendChild(exerciseItem);
          
          // Add event listeners for editing, deleting, and changing exercise properties
          const typeRadios = exerciseItem.querySelectorAll('input[type="radio"]');
          typeRadios.forEach(radio => {
            radio.addEventListener('change', (e) => {
              updateExercise(exercise.id, { type: e.target.value });
            });
          });
          
          const inputs = exerciseItem.querySelectorAll('input[type="number"]');
          inputs.forEach(input => {
            input.addEventListener('change', (e) => {
              const field = e.target.dataset.field;
              const value = parseInt(e.target.value, 10);
              
// Continuing from where the script left off...

              // Validate input
              if (isNaN(value) || value < parseInt(e.target.min, 10) || value > parseInt(e.target.max, 10)) {
                showToast(`Value must be between ${e.target.min} and ${e.target.max}`, 'error');
                e.target.value = e.target.dataset.lastValue || e.target.min;
                return;
              }
              
              e.target.dataset.lastValue = value;
              updateExercise(exercise.id, { [field]: value });
            });
            
            // Store initial value for validation
            input.dataset.lastValue = input.value;
          });
          
          // Edit exercise name
          const exerciseName = exerciseItem.querySelector('.exercise-name');
          exerciseName.addEventListener('click', (e) => {
            const currentName = e.target.textContent;
            const newName = prompt('Enter exercise name:', currentName);
            
            if (newName && newName.trim() !== '') {
              updateExercise(exercise.id, { name: newName.trim() });
            }
          });
          
          // Delete exercise
          const deleteBtn = exerciseItem.querySelector('[data-action="delete"]');
          deleteBtn.addEventListener('click', () => {
            if (confirm('Are you sure you want to delete this exercise?')) {
              removeExercise(exercise.id);
            }
          });
        });
        
        // Initialize drag and drop
        initDragAndDrop();
      }

      // Drag and drop functionality
      function initDragAndDrop() {
        const items = document.querySelectorAll('.exercise-item');
        
        items.forEach(item => {
          const dragHandle = item.querySelector('.drag-handle');
          
          dragHandle.addEventListener('mousedown', (e) => {
            e.preventDefault();
            
            const currentIndex = parseInt(item.dataset.index, 10);
            state.lastDraggedIndex = currentIndex;
            
            const startY = e.clientY;
            const itemHeight = item.offsetHeight;
            const originalPosition = item.getBoundingClientRect();
            
            // Create placeholder
            const placeholder = document.createElement('div');
            placeholder.style.height = `${itemHeight}px`;
            placeholder.className = 'exercise-placeholder';
            item.parentNode.insertBefore(placeholder, item);
            
            // Style dragged item
            item.style.position = 'absolute';
            item.style.zIndex = 1000;
            item.style.width = `${originalPosition.width}px`;
            item.style.left = `${originalPosition.left}px`;
            item.style.top = `${originalPosition.top}px`;
            item.classList.add('dragging');
            
            function moveAt(y) {
              item.style.top = `${y - itemHeight / 2}px`;
              
              // Find closest placeholder position
              const exerciseItems = Array.from(document.querySelectorAll('.exercise-item, .exercise-placeholder'));
              let closestItem = null;
              let closestDistance = Infinity;
              
              exerciseItems.forEach(el => {
                if (el === item || el === placeholder) return;
                
                const box = el.getBoundingClientRect();
                const distance = Math.abs(box.top + box.height / 2 - y);
                
                if (distance < closestDistance) {
                  closestDistance = distance;
                  closestItem = el;
                }
              });
              
              if (closestItem) {
                placeholder.remove();
                closestItem.parentNode.insertBefore(
                  placeholder,
                  closestItem.nextSibling && closestItem.nextSibling.classList.contains('exercise-placeholder') ? 
                    closestItem : closestItem.nextSibling
                );
              }
            }
            
            function onMouseMove(e) {
              moveAt(e.clientY);
            }
            
            function onMouseUp() {
              document.removeEventListener('mousemove', onMouseMove);
              document.removeEventListener('mouseup', onMouseUp);
              
              // Find new position
              const allItems = Array.from(document.querySelectorAll('.exercise-item, .exercise-placeholder'));
              const newIndex = allItems.indexOf(placeholder);
              
              // Move exercise in state
              if (newIndex !== -1 && newIndex !== state.lastDraggedIndex) {
                moveExercise(state.lastDraggedIndex, newIndex > state.lastDraggedIndex ? newIndex - 1 : newIndex);
              } else {
                // Reset without updating (render will be called if moved)
                item.style.position = '';
                item.style.zIndex = '';
                item.style.width = '';
                item.style.left = '';
                item.style.top = '';
                item.classList.remove('dragging');
                placeholder.remove();
              }
            }
            
            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('mouseup', onMouseUp);
          });
        });
      }

      // Timer and workout functionality
      function startWorkout() {
        if (state.exercises.length === 0) {
          showToast('Add at least one exercise to start a workout', 'error');
          return;
        }
        
        // Reset state
        state.activeExerciseIndex = 0;
        state.currentSet = 1;
        state.isResting = false;
        state.isWorkoutActive = true;
        state.workoutStartTime = Date.now();
        state.elapsedTime = 0;
        state.activeTime = 0;
        state.restTime = 0;
        state.isPaused = false;
        state.completedExercises = 0;
        state.completedSets = 0;
        
        // Update UI
        document.body.classList.add('workout-active');
        startWorkoutBtn.classList.add('hidden');
        pauseWorkoutBtn.classList.remove('hidden');
        stopWorkoutBtn.classList.remove('hidden');
        
        // Switch to workout tab
        activateTab('workout');
        
        // Render workout exercises
        renderWorkoutExercises();
        
        // Start the current exercise
        startCurrentExercise();
        
        // Start elapsed time counter
        startElapsedTimeCounter();
        
        // Play beep to indicate workout start
        playBeep();
      }

      function renderWorkoutExercises() {
        workoutExerciseList.innerHTML = '';
        
        state.exercises.forEach((exercise, index) => {
          const isActive = index === state.activeExerciseIndex;
          const isPending = index > state.activeExerciseIndex;
          const isCompleted = index < state.activeExerciseIndex;
          
          const exerciseEl = document.createElement('div');
          exerciseEl.className = `workout-exercise ${isActive ? 'active' : ''} ${isPending ? 'pending' : ''} ${isCompleted ? 'completed' : ''}`;
          exerciseEl.dataset.index = index;
          
          const totalSets = exercise.sets;
          const currentSet = index === state.activeExerciseIndex ? state.currentSet : 
                            (isCompleted ? totalSets + 1 : 0);
          
          exerciseEl.innerHTML = `
            <div class="workout-exercise-header">
              <span class="workout-exercise-name">${exercise.name}</span>
              <span class="workout-exercise-progress">
                ${Math.min(currentSet, totalSets)}/${totalSets} sets
              </span>
            </div>
            <div class="workout-exercise-details">
              ${exercise.type === 'timed' ? 
                `<span>${exercise.duration}s work / ${exercise.rest}s rest</span>` : 
                `<span>${exercise.reps} reps / ${exercise.rest}s rest</span>`}
            </div>
            <div class="progress-container">
              <div class="progress-bar" style="width: ${Math.min(currentSet / totalSets * 100, 100)}%"></div>
            </div>
          `;
          
          workoutExerciseList.appendChild(exerciseEl);
        });
        
        // Scroll to active exercise
        if (state.activeExerciseIndex !== -1) {
          const activeExercise = workoutExerciseList.querySelector('.workout-exercise.active');
          if (activeExercise) {
            activeExercise.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }
        }
      }
      
      function startCurrentExercise() {
        if (state.activeExerciseIndex >= state.exercises.length) {
          completeWorkout();
          return;
        }
        
        const exercise = state.exercises[state.activeExerciseIndex];
        
        // Reset timer
        clearInterval(state.timer);
        
        if (state.isResting) {
          // Rest period
          workoutStatus.textContent = `Rest`;
          workoutStatus.className = 'status resting';
          state.remainingTime = exercise.rest;
          
          if (exercise.rest > 0) {
            state.timer = setInterval(updateTimer, 1000);
          } else {
            // Skip rest if rest time is 0
            completeRest();
            return;
          }
        } else {
          // Exercise period
          workoutStatus.textContent = `${exercise.name} - Set ${state.currentSet}/${exercise.sets}`;
          workoutStatus.className = 'status active';
          
          if (exercise.type === 'timed') {
            state.remainingTime = exercise.duration;
            state.timer = setInterval(updateTimer, 1000);
          } else {
            // For rep-based exercises, just show the reps
            timerDisplay.textContent = `${exercise.reps} reps`;
            // Add a "Next" button for rep-based exercises
            renderRepBasedControls();
          }
        }
        
        updateTimer();
        renderWorkoutExercises();
      }
      
      function renderRepBasedControls() {
        const controlsContainer = document.getElementById('repBasedControls') || document.createElement('div');
        controlsContainer.id = 'repBasedControls';
        controlsContainer.className = 'rep-based-controls';
        controlsContainer.innerHTML = `
          <button id="completedRepsBtn" class="btn primary">Completed</button>
        `;
        
        // Add it after the timer display
        const timerContainer = document.querySelector('.timer-container');
        if (!document.getElementById('repBasedControls')) {
          timerContainer.appendChild(controlsContainer);
        }
        
        document.getElementById('completedRepsBtn').addEventListener('click', completeExercise);
      }
      
      function removeRepBasedControls() {
        const controls = document.getElementById('repBasedControls');
        if (controls) {
          controls.remove();
        }
      }
      
      function updateTimer() {
        if (state.isPaused) return;
        
        if (state.remainingTime <= 0) {
          clearInterval(state.timer);
          playBeep();
          
          if (state.isResting) {
            completeRest();
          } else {
            completeExercise();
          }
          return;
        }
        
        timerDisplay.textContent = formatTime(state.remainingTime);
        
        // Update progress circle
        const exercise = state.exercises[state.activeExerciseIndex];
        const totalTime = state.isResting ? exercise.rest : exercise.duration;
        const percentage = (totalTime - state.remainingTime) / totalTime * 100;
        
        const progressCircle = document.querySelector('.progress-circle');
        if (progressCircle) {
          progressCircle.style.background = `conic-gradient(
            ${state.isResting ? 'var(--rest-color)' : 'var(--primary-color)'}
            ${percentage * 3.6}deg,
            #f0f0f0 0deg
          )`;
        }
        
        // Track time
        if (state.isResting) {
          state.restTime++;
        } else {
          state.activeTime++;
        }
        
        state.remainingTime--;
      }
      
      function completeExercise() {
        removeRepBasedControls();
        
        const exercise = state.exercises[state.activeExerciseIndex];
        
        if (state.currentSet < exercise.sets) {
          // Move to rest period before next set
          state.isResting = true;
          startCurrentExercise();
        } else {
          // Move to next exercise
          state.completedExercises++;
          state.completedSets += exercise.sets;
          state.activeExerciseIndex++;
          state.currentSet = 1;
          state.isResting = false;
          
          if (state.activeExerciseIndex < state.exercises.length) {
            startCurrentExercise();
          } else {
            completeWorkout();
          }
        }
      }
      
      function completeRest() {
        state.isResting = false;
        state.currentSet++;
        startCurrentExercise();
      }
      
      function pauseWorkout() {
        if (!state.isWorkoutActive) return;
        
        state.isPaused = !state.isPaused;
        
        if (state.isPaused) {
          clearInterval(state.timer);
          pauseWorkoutBtn.textContent = 'Resume';
          pauseWorkoutBtn.classList.add('paused');
          workoutStatus.classList.add('paused');
        } else {
          if (state.exercises[state.activeExerciseIndex].type === 'timed' || state.isResting) {
            state.timer = setInterval(updateTimer, 1000);
          }
          pauseWorkoutBtn.textContent = 'Pause';
          pauseWorkoutBtn.classList.remove('paused');
          workoutStatus.classList.remove('paused');
        }
      }
      
      function stopWorkout() {
        if (!state.isWorkoutActive) return;
        
        if (confirm('Are you sure you want to stop the workout?')) {
          clearInterval(state.timer);
          state.isWorkoutActive = false;
          document.body.classList.remove('workout-active');
          startWorkoutBtn.classList.remove('hidden');
          pauseWorkoutBtn.classList.add('hidden');
          stopWorkoutBtn.classList.add('hidden');
          
          // Calculate final stats
          const totalDuration = Math.floor((Date.now() - state.workoutStartTime) / 1000);
          
          // Show summary modal
          showWorkoutSummary(totalDuration);
        }
      }
      
      function completeWorkout() {
        playBeep();
        clearInterval(state.timer);
        state.isWorkoutActive = false;
        document.body.classList.remove('workout-active');
        startWorkoutBtn.classList.remove('hidden');
        pauseWorkoutBtn.classList.add('hidden');
        stopWorkoutBtn.classList.add('hidden');
        
        // Calculate final stats
        const totalDuration = Math.floor((Date.now() - state.workoutStartTime) / 1000);
        
        // Show completion message
        timerDisplay.textContent = 'Complete!';
        workoutStatus.textContent = 'Workout Finished';
        workoutStatus.className = 'status completed';
        
        // Show summary modal
        showWorkoutSummary(totalDuration);
      }
      
      function showWorkoutSummary(totalDuration) {
        // Populate summary data
        summaryDuration.textContent = formatTime(totalDuration);
        summaryExercises.textContent = state.completedExercises;
        summarySets.textContent = state.completedSets;
        summaryActiveTime.textContent = formatTime(state.activeTime);
        summaryRestTime.textContent = formatTime(state.restTime);
        
        // Show modal
        summaryModal.classList.add('active');
      }
      
      function startElapsedTimeCounter() {
        const startTime = Date.now();
        
        setInterval(() => {
          if (!state.isWorkoutActive || state.isPaused) return;
          
          const elapsed = Math.floor((Date.now() - startTime) / 1000);
          elapsedTimeDisplay.textContent = formatTime(elapsed);
        }, 1000);
      }
      
      function updateWorkoutInfo() {
        // Calculate total exercises and sets
        const totalExercises = state.exercises.length;
        const totalSets = state.exercises.reduce((sum, ex) => sum + ex.sets, 0);
        
        // Calculate estimated duration
        let totalSeconds = 0;
        state.exercises.forEach(exercise => {
          if (exercise.type === 'timed') {
            totalSeconds += exercise.sets * (exercise.duration + exercise.rest);
          } else {
            // Estimate 3 seconds per rep for rep-based exercises
            totalSeconds += exercise.sets * (exercise.reps * 3 + exercise.rest);
          }
        });
        
        // Update displays
        totalExercisesDisplay.textContent = totalExercises;
        totalSetsDisplay.textContent = totalSets;
        totalTimeDisplay.textContent = formatTime(totalSeconds);
        
        // Enable/disable start button
        startWorkoutBtn.disabled = totalExercises === 0;
      }
      
      // Tab functionality
      function activateTab(tabName) {
        tabButtons.forEach(button => {
          button.classList.toggle('active', button.dataset.tab === tabName);
        });
        
        tabContents.forEach(content => {
          content.classList.toggle('active', content.dataset.tab === tabName);
        });
      }
      
      // Presets
      function loadPreset(presetName) {
        // Clear current exercises
        state.exercises = [];
        
        switch (presetName) {
          case 'quick-hiit':
            state.exercises = [
              { id: Date.now(), name: 'Jumping Jacks', type: 'timed', duration: 30, rest: 10, sets: 3 },
              { id: Date.now() + 1, name: 'Push-ups', type: 'timed', duration: 30, rest: 10, sets: 3 },
              { id: Date.now() + 2, name: 'Mountain Climbers', type: 'timed', duration: 30, rest: 10, sets: 3 },
              { id: Date.now() + 3, name: 'Burpees', type: 'timed', duration: 30, rest: 10, sets: 3 }
            ];
            break;
          case 'strength-circuit':
            state.exercises = [
              { id: Date.now(), name: 'Squats', type: 'reps', reps: 12, rest: 60, sets: 3 },
              { id: Date.now() + 1, name: 'Push-ups', type: 'reps', reps: 10, rest: 60, sets: 3 },
              { id: Date.now() + 2, name: 'Lunges', type: 'reps', reps: 10, rest: 60, sets: 3 },
              { id: Date.now() + 3, name: 'Plank', type: 'timed', duration: 45, rest: 60, sets: 3 }
            ];
            break;
          case 'tabata':
            state.exercises = [
              { id: Date.now(), name: 'High Knees', type: 'timed', duration: 20, rest: 10, sets: 8 },
              { id: Date.now() + 1, name: 'Squats', type: 'timed', duration: 20, rest: 10, sets: 8 }
            ];
            break;
          case '5x5':
            state.exercises = [
              { id: Date.now(), name: 'Squats', type: 'reps', reps: 5, rest: 90, sets: 5 },
              { id: Date.now() + 1, name: 'Bench Press', type: 'reps', reps: 5, rest: 90, sets: 5 },
              { id: Date.now() + 2, name: 'Barbell Rows', type: 'reps', reps: 5, rest: 90, sets: 5 }
            ];
            break;
        }
        
        renderExercises();
        updateWorkoutInfo();
      }
      
      // Import/Export functionality
      function exportWorkout() {
        if (state.exercises.length === 0) {
          showToast('No exercises to export', 'error');
          return;
        }
        
        const workout = {
          name: 'My Workout',
          exercises: state.exercises,
          created: new Date().toISOString()
        };
        
        const dataStr = JSON.stringify(workout, null, 2);
        const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
        
        const exportName = `workout_${new Date().toISOString().slice(0,10)}.json`;
        
        const linkElement = document.createElement('a');
        linkElement.setAttribute('href', dataUri);
        linkElement.setAttribute('download', exportName);
        linkElement.click();
        
        showToast('Workout exported successfully', 'success');
      }
      
      function importWorkout() {
        fileInput.click();
      }
      
      function handleFileImport(e) {
        const file = e.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = function(e) {
          try {
            const workout = JSON.parse(e.target.result);
            
            if (!workout.exercises || !Array.isArray(workout.exercises)) {
              throw new Error('Invalid workout file format');
            }
            
            state.exercises = workout.exercises;
            renderExercises();
            updateWorkoutInfo();
            
            showToast('Workout imported successfully', 'success');
          } catch (error) {
            showToast('Error importing workout: ' + error.message, 'error');
          }
          
          // Reset file input
          fileInput.value = '';
        };
        
        reader.readAsText(file);
      }
      
      // Event Listeners
      addExerciseBtn.addEventListener('click', () => addExercise());
      startWorkoutBtn.addEventListener('click', startWorkout);
      pauseWorkoutBtn.addEventListener('click', pauseWorkout);
      stopWorkoutBtn.addEventListener('click', stopWorkout);
      
      tabButtons.forEach(button => {
        button.addEventListener('click', () => {
          activateTab(button.dataset.tab);
        });
      });
      
      presetCards.forEach(card => {
        card.addEventListener('click', () => {
          loadPreset(card.dataset.preset);
        });
      });
      
      exportBtn.addEventListener('click', exportWorkout);
      importBtn.addEventListener('click', importWorkout);
      fileInput.addEventListener('change', handleFileImport);
      
      closeSummaryModal.addEventListener('click', () => {
        summaryModal.classList.remove('active');
      });
      
      // Initialize
      renderExercises();
      updateWorkoutInfo();
      activateTab('setup');
    });
  </script>
  </body>
  </html>